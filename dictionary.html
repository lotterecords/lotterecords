<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Neologism Dictionary</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #d2b9a9;
      color: #222;
      padding: 2em;
      max-width: 900px;
      margin: auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 1em;
    }

    .controls {
      text-align: center;
      margin-bottom: 1.5em;
    }

    .entry {
      border-bottom: 1px solid #ccc;
      padding: 1em 0;
    }

.word {
  font-weight: bold;
  font-size: 1.8em;
  margin-bottom: 0.2em;
}

.date {
  font-style: italic;
  font-size: 0.9em;
  color: #666;
  margin-bottom: 0.6em;
}

.intro {
  font-weight: normal;
  font-size: 1.1em;
  margin-bottom: 0.8em;
  line-height: 1.5em;
}

.definition {
  font-size: 1em;
  line-height: 1.6em;
  white-space: normal;
}

  </style>
</head>
<body>

  <h1>The Lotte New Dictionary</h1>
  <h3>Deep, deep beneath the mantle of the Earth, a slave named Raspberry is tirelessly struggling to create definitions for our daily neologisms. Since he can not die, we intend for Raspberry to compile enough definitions in The Lotte New Dictionary to outrank the Oxford English Dictionary as the world's longest. At the current rate, it should take ~ 164 years to do so but (with necessary pressure being dutifully applied) we hope that we can create efficencies to allow us directors to see our special New Dictionary crowned king while still alive.</h3>
  <h3>We accept that the definitions are not perfect (nothing is), but given the task at hand being rather undoable, we generally pardon Raspberry when we find that a definition is less than perfect. His life is bad enough.</h3>
  <h4>You may sort by date or alphabetically.</h4>

  <div class="controls">
    <button onclick="sortByDate()">Sort by Date</button>
    <button onclick="sortByWord()">Sort Alphabetically</button>
  </div>

  <div id="entries">Loading...</div>

    <script>
    let entries = [];

async function loadDefinitions() {
  const res = await fetch('daily_neologisms.txt');
  const text = await res.text();

  const blocks = text.split(/\n(?=\[\d{4}-\d{2}-\d{2}\])/g);

  entries = blocks.map(block => {
    const dateMatch = block.match(/\[(\d{4}-\d{2}-\d{2})\]/);
    const date = dateMatch ? dateMatch[1] : 'Unknown';
    const lines = block.split('\n').map(l => l.trim()).filter(Boolean);

    // Try to find a line like **Word** or \**Word**
    let wordLine = lines.find(line => /\*{2}.*\*{2}/.test(line));
    let word = 'Untitled';

    if (wordLine) {
      // Remove any leading slashes or brackets
      const clean = wordLine.replace(/^[\\\[]*/, '').replace(/[\\\]]*$/, '');
      const match = clean.match(/\*{2}(.*?)\*{2}/);
      if (match && match[1]) word = match[1].trim();
    }

    // Clean definition (everything except date and word line)
    const contentLines = lines.filter(
      l => l !== `[${date}]` && !/\*{2}.*\*{2}/.test(l)
    );

    return {
      date,
      word,
      definition: contentLines.join('\n').replace(/\[0m/g, '').trim()
    };
  });

  sortByDate();
}

function render(list) {
  const entriesDiv = document.getElementById('entries');
  entriesDiv.innerHTML = '';

  for (const e of list) {
    const lines = e.definition.split('\n').filter(line => line.trim() !== '');

    let intro = '';
    let example = '';
    let def = '';
    let section = 'intro';

    for (let line of lines) {
      if (/^Example sentence[:：]?\s*$/i.test(line)) {
        section = 'example';
        continue;
      } else if (/^Definition[:：]?\s*$/i.test(line)) {
        section = 'definition';
        continue;
      }

      if (section === 'intro') {
        intro += line + ' ';
      } else if (section === 'example') {
        example += line + '<br>';
      } else if (section === 'definition') {
        def += line + '<br>';
      }
    }

    entriesDiv.innerHTML += `
      <div class="entry">
        <div class="word">${e.word}</div>
        <div class="date">${e.date}</div>
        <div class="intro">${intro.trim()}</div>
        ${example ? `<div class="definition"><strong>Example sentence:</strong><br>${example}</div>` : ''}
        ${def ? `<div class="definition"><strong>Definition:</strong><br>${def}</div>` : ''}
      </div>
    `;
  }
}

    function sortByDate() {
      const sorted = [...entries].sort((a, b) => new Date(b.date) - new Date(a.date));
      render(sorted);
    }

    function sortByWord() {
      const sorted = [...entries].sort((a, b) => a.word.localeCompare(b.word));
      render(sorted);
    }

    loadDefinitions();
  </script>

</body>
</html>